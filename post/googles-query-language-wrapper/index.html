<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Access and query public Google Sheets easily with a JS wrapper for Google's Visualization API Query Language to fetch and filter spreadsheet data quickly." />
    <meta name="google-site-verification" content="uvbH-6ck13HtnTSvTxZ22YRcI3wok9_oj7X8Aodexo8" />

    <!--Site icon-->
    
    <link rel="icon" href="/content/uploads/images/lebcit-favicon-8fbda27700a3444e.svg" />
    

    <!--Title-->
    <title>Google's Query Language Wrapper | { LebCit }</title>

    <!--Stylesheets-->
    <link rel="stylesheet" href="/content/themes/midday-custom/assets/css/style.css" />
    
    <link rel="stylesheet" href="/content/themes/midday-custom/assets/vendors/atom-one-dark.min.css" />
    
</head>


    <body>
        <!--Start page-->
        <div id="page" class="site grid">
            <a class="skip-link screen-reader-text" href="#content">Skip to content</a>

            <!--Start menu-->
            <div id="main-nav" aria-label="Main navigation" class="menu-overlay menu-overlay--hidden" tabindex="-1">
    <a href="#" id="close-button" class="menu-overlay__close" aria-label="Close menu" title="Close menu">&times;</a>

    <div class="menu-overlay__content">
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/" target="">Home</a>
        </li>
        
        <!---->
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/blog" target="_self">Blog</a>
        </li>
        
        <!---->
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/categories" target="_self">Categories</a>
        </li>
        
        <!---->
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/tags" target="_self">Tags</a>
        </li>
        
        <!---->
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/search" target="_self">Search</a>
        </li>
        
        <!---->
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/page/my-public-projects" target="_self">Projects</a>
        </li>
        
        <!---->
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/page/about-me" target="_self">About Me</a>
        </li>
        
        <!---->
        
        <!---->
        
        <li class="menu-overlay__item ">
            <a href="/sitemap" target="_self">Sitemap</a>
        </li>
        
        <!---->
        
    </div>
</div>

            <!--End menu-->

            <!--Start masthead-->
            <!-- Start #masthead -->

<header
    id="masthead"
    class="site-header unit-1 unit-lg-2-5 bio"
    style="background-image: url(/content/uploads/images/js-api-wrapper-logo-generated-with-ai-8a40903af1de13be.webp)"
>
    <div class="site-header__overlay"></div>

    <!-- Start .site-header__content -->
<div class="site-header__content">
    <div class="site-header__branding">
        <h1 class="site-header__title">
            <a href="/">{ LebCit }</a>
        </h1>
        <p class="site-header__description">Self-taught Web Developer with a passion for reading, continuous learning, and tackling projects on my own!</p>
    </div>

    <nav id="nav" class="site-header__nav" aria-label="MENU">
        <ul class="site-header__nav-list">
            <li class="site-header__nav-item">
                <a id="menu-button" aria-controls="main-nav" aria-haspopup="true" tabindex="0" role="button">
                    <span>MENU</span>
                    <span class="menu-icon" aria-hidden="true">
                        <svg
                            version="1.1"
                            x="0px"
                            y="0px"
                            width="30px"
                            height="30px"
                            viewBox="0 0 30 30"
                            enable-background="new 0 0 30 30"
                        >
                            <rect width="30" height="5" />
                            <rect y="24" width="30" height="5" />
                            <rect y="12" width="30" height="5" />
                        </svg>
                    </span>
                </a>
            </li>
        </ul>
    </nav>
</div>
<!-- End .site-header__content -->

</header>

<!-- End #masthead -->

            <!--End masthead-->

            <!--Start content-->
            <div id="content" class="site-content unit-1 unit-lg-3-5">
                <main
    class="article-view"
>
    
    <!--The page to display the Markdown content of posts and pages.-->
    <header class="post-header">
    <h1 class="post-title">Google's Query Language Wrapper</h1>

     <div class="post-meta">
    <div class="post-date-wrapper">
        <span>Posted:</span>
        <time class="post-date" datetime="2025-06-03T16:40:16.179Z">
            2024-04-22
        </time>

        
        <span class="separator">|</span>
        <span>Updated:</span>
        <time class="post-updated-date" datetime="2025-06-03T19:42:02.026Z">
            2025-06-03
        </time>
        
    </div>

    
    <div class="taxonomy-group">
        <span>Category:</span>
        <span class="post-category">
            <a href="/category/javascript-tools">javascript-tools</a>
        </span>
    </div>
    
    <!---->
    
    <div class="taxonomy-group post-tags-group">
        <span>Tagged:</span>
        
        <a class="post-tag" href="/tag/google-sheets">google-sheets</a>
        
        <a class="post-tag" href="/tag/api-wrapper">api-wrapper</a>
        
        <a class="post-tag" href="/tag/javascript">javascript</a>
        
        <a class="post-tag" href="/tag/data-querying">data-querying</a>
        
        <a class="post-tag" href="/tag/google-visualization-api">google-visualization-api</a>
        
    </div>
    
</div>
 
</header>

<div class="article-content">
    
    <p>
        <em>Access and query public Google Sheets easily with a JS wrapper for Google's Visualization API Query Language to fetch and filter spreadsheet data quickly.</em>
    </p>
    

    <!--Content-->
    <p>Some years ago (2021), I&#39;ve used <a href="https://developers.google.com/sheets">Google Sheets</a> as a data store and created some useful applications using <a href="https://developers.google.com/apps-script">Apps Script</a>.<br />
Recently, I needed to get the data of a publicly available and editable spreadsheet for a project that I&#39;m working on.<br />
Initially, I considered using Apps Script, but then I discovered a simpler solution:<br />
<strong>GViz</strong> aka <a href="https://developers.google.com/chart/interactive/docs/querylanguage">Google Visualization API Query Language</a>!</p>
<p>GViz is well-documented and easy to use for accessing spreadsheets shared with &#39;anyone who has the link can view&#39; permissions, without requiring credentials, as explained in the authorization section of <a href="https://developers.google.com/chart/interactive/docs/spreadsheets#authorization">Ingest Data from Google Sheets</a>.</p>
<p>After reading the documentation, I understood that getting data from a public spreadsheet is a easy as the following:</p>
<pre><code class="language-js">// Construct the URL for accessing the Google Sheets document data
let url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq`

// Fetch data from the specified URL
let response = await fetch(url)

// Read the text content from the response
let jsonpResponse = await response.text()
</code></pre>
<p>As detailed in the <a href="https://developers.google.com/chart/interactive/docs/dev/implementing_data_source#json-response-format">JSON Response Format</a> section, the returned response format defaults to <a href="https://en.wikipedia.org/wiki/JSONP">JSONP</a> when no authentication process is detected.<br />
To have an idea of the returned response, take a look at the <a href="https://developers.google.com/chart/interactive/docs/dev/implementing_data_source#examples">Examples</a> section.<br />
As we can see, the data we&#39;re looking for resides in the <code>table</code> property. Lets extract the JSON from the response and parse it by adding after the previous code the following one:</p>
<pre><code class="language-js">// Extract the JSON string from the JSONP response
let jsonMatch = jsonpResponse.match(/google.visualization.Query.setResponse\((.*?)\);/)
let jsonString = jsonMatch ? jsonMatch[1] : &quot;&quot;

// Parse the JSON string into a JavaScript object
let jsonObject = JSON.parse(jsonString)
</code></pre>
<p>We can now access the <code>table</code> with <code>jsonObject.table</code> or <code>jsonObject[&quot;table&quot;]</code>. The table displays the data in 2 separated arrays of objects:</p>
<ol>
<li>&quot;cols&quot;, the columns where each object represents a column with its <code>id</code>, <code>label</code>, <code>pattern</code> and <code>type</code></li>
<li>&quot;rows&quot;, the rows where each object holds the corresponding data</li>
</ol>
<p>If all we want is to get the data from the spreadsheet, a simple function can do the job like the following one:</p>
<pre><code class="language-js">function convertTableToObjectArray(table) {
    // Get column labels and types
    const columnLabelsAndTypes = table.cols.map((col) =&gt; ({
        label: col.label,
        type: col.type,
    }))

    // Convert table rows to array of objects
    const arrayOfObjects = table.rows.map((row) =&gt; {
        const obj = {}
        row.c.forEach((cell, index) =&gt; {
            const { label, type } = columnLabelsAndTypes[index]
            // Use formatted value if type is string, otherwise use value
            obj[label] = type === &quot;string&quot; ? cell.v : cell.f
        })
        return obj
    })

    return arrayOfObjects
}

// Access the data inside the `table`
let dataTable = jsonObject.table

// Convert dataTable to an array of objects
const arrayOfObjects = convertTableToObjectArray(dataTable)
console.log(arrayOfObjects)
</code></pre>
<p>And that would be it since we now have an array of objects that we can manipulate as we want!</p>
<p>However, GViz provides additional benefits as its description indicates that it enables us to conduct diverse data manipulations using the <strong>query</strong> on the data source.<br/>
In short, we can add some parameters after the URL to modify the returned response.<br />
The available parameters are detailed in the following sections:</p>
<ol>
<li><a href="https://developers.google.com/chart/interactive/docs/dev/implementing_data_source#request-format">Request Format</a> → <code>tq</code> and <code>tqx</code></li>
<li><a href="https://developers.google.com/chart/interactive/docs/spreadsheets#creating-a-chart-from-a-separate-spreadsheet">Creating a Chart from a Separate Spreadsheet</a> → <code>headers</code>, <code>gid</code> and <code>sheet</code></li>
<li><a href="https://developers.google.com/chart/interactive/docs/spreadsheets#query-source-ranges">Query Source Ranges</a> → <code>range</code></li>
</ol>
<p>The <code>tq</code> parameter (table query) uses the <a href="https://developers.google.com/chart/interactive/docs/querylanguage#language-clauses">Language Clauses</a> as an <strong>encoded string</strong> to deliver the data corresponding to the <strong>query</strong>.<br />
The <code>tqx</code> parameter is <strong>a set of colon-delimited key/value pairs</strong> to get the response in a particular format (<code>out</code>), with or without an optional JS callback function (<code>responseHandler</code>), and optionally export it into a specified filename (<code>outFileName</code>).<br />
The <code>headers</code> parameter <strong>specifies how many rows are header rows</strong>.<br />
The <code>gid</code> (id number of the sheet) and <code>sheet</code> (the name of the sheet) define the sheet we want to work on in a multi-sheet document, we should only use one of them and not both.<br />
The <code>range</code> parameter <strong>specifies what part of a spreadsheet to use in the query</strong>, going from a single cell to the whole spreadsheet.</p>
<p>Considering that the data could be returned in a <a href="https://developers.google.com/chart/interactive/docs/dev/implementing_data_source#csv-response-format">CSV Response Format</a>, I pursued an alternative approach, as my objective was not solely to retrieve the data but also to extract a subset based on specific conditions.<br />
So instead of getting the data then extract the needed part of it with JS, I used GViz powers to do it in three steps:</p>
<ol>
<li>Get the data in csv format<br />
<code>https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv</code></li>
<li>Add parameters to extract only the desired part of the data<br />
<code>headers</code>, <code>gid</code> or <code>sheet</code>, <code>range</code> and finally <code>tq</code></li>
<li>Parse the CSV data into an array of objects so it can be easily accessible and manipulated</li>
</ol>
<p>Looking at the table provided as an example under the <a href="https://developers.google.com/chart/interactive/docs/querylanguage#overview">Language Syntax Overview</a> and paying attention to the fact <strong>that column IDs in spreadsheets are always letters</strong>, as explained in <a href="https://developers.google.com/chart/interactive/docs/querylanguage#setting-the-query-in-the-data-source-url">Setting the Query in the Data Source URL</a>, suppose that we want to run the following query:</p>
<ol>
<li>Get the data from the sheet named Employees_Data (assuming a multi-sheet document)</li>
<li>Work only on the range from A1 to D6 (name to salary and 5 rows)</li>
<li>Return only the data in the name&#39;s column (A)</li>
<li>Where the name <code>starts with &#39;Da&#39;</code></li>
<li>Arrange the data by ascending order of salary</li>
</ol>
<p>The URL for this request would be something like:</p>
<pre><code class="language-js">let url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:csv&amp;headers=1&amp;sheet=Employees_Data&amp;range=A1:D6&amp;tq=SELECT%20A%20WHERE%20A%20starts%20with%20&#39;Da&#39;%20ORDER%20BY%20D%20asc`
</code></pre>
<p>where <code>${sheetID}</code> consists of 44 characters. It&#39;s a combination of letters, numbers, and special characters, such as hyphens and underscores.<br />
As the query complexity increases, it becomes progressively challenging to write and comprehend, making it visually unappealing.<br />
That&#39;s why I developed GoogleQLWrapper, a JavaScript class that retrieves data from a public spreadsheet, accommodating various parameters based on the document&#39;s structure and the user&#39;s requirements.<br />
GoogleQLWrapper provides two asynchronous methods:</p>
<ol>
<li><code>getSheetData (sheetID, queryOptions = {})</code></li>
<li><code>getSourceData (sheetID, sheetName)</code></li>
</ol>
<p>You can find more documentation about it on the <a href="https://github.com/LebCit/GoogleQLWrapper">GoogleQLWrapper GitHub repository</a>.</p>
<p>I hope that you&#39;ll find it useful.</p>

</div>

<nav
    class="post-navigation"
    aria-label="Post Navigation"
>
    

    <!-- Dynamic Markup Separator -->

    

    <!-- Dynamic Markup Separator -->

    
    <!-- Previous Post Link (only if there's a previous post) -->
    <a href="/post/responsive-attributes-generator" class="prev-post" rel="prev" aria-label="Go to the previous post">
        Previous: Responsive Attributes Generator
    </a>
    

    <!--Dynamic Markup Separator-->

    
    <!-- Next Post Link (only if there's a next post) -->
    <a href="/post/creating-conditional-selections-in-google-forms-using-apps-script" class="next-post" rel="next" aria-label="Go to the next post">
        Next: Creating Conditional Selections in Google Forms using Apps Script
    </a>
    
</nav>


<!---->
 <div class="related-posts">
    <h3>You Might Also Like</h3>
    <div>
        
        <section>
            <a href="/post/creating-conditional-selections-in-google-forms-using-apps-script">
                <img
                    class="img-responsive"
                    src="/content/uploads/images/conditional-selections-generated-with-ai-27e18753b03f313c.avif"
                    alt="Featured image for the post: Creating Conditional Selections in Google Forms using Apps Script"
                />
            </a>
            <h4>
                <a href="/post/creating-conditional-selections-in-google-forms-using-apps-script">Creating Conditional Selections in Google Forms using Apps Script</a>
            </h4>
        </section>
        
        <section>
            <a href="/post/get-google-products-on-desktop-with-thunderbird">
                <img
                    class="img-responsive"
                    src="/content/uploads/images/red-thunderbird-classic-car-photography-9a6d7c7a15809e10.webp"
                    alt="Featured image for the post: Get Google Products on Desktop with Thunderbird"
                />
            </a>
            <h4>
                <a href="/post/get-google-products-on-desktop-with-thunderbird">Get Google Products on Desktop with Thunderbird</a>
            </h4>
        </section>
        
    </div>
</div>
 

    <!---->

    
</main>

            </div>
            <!--End content-->

            <!--Start footer-->
            <footer id="colophon" class="site-footer unit-1">
    <div id="site-info" class="site-info">
        
        <p>
            <strong>2016 - 2025 { LebCit }</strong>

            <br />
            <!-- Custom Footer Code -->
            Content in Motion. Powered by Aether.
        </p>
    </div>
</footer>

            <!--End footer-->
        </div>
        <!--End page-->

        
        <script src="/content/themes/midday-custom/assets/vendors/highlight.min.js" onload="hljs.highlightAll()"></script>
        

        <script type="module" src="/content/themes/midday-custom/assets/js/main.js"></script>

        
    </body>
</html>
