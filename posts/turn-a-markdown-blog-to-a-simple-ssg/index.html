<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	
	<meta name="description" content="This post is about improving a Markdown blog and turn it into a simple SSG" />
	

	<title>Turn a Markdown blog to a simple SSG | { LebCit }</title>

	<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon_32.png" />
	<link rel="stylesheet" href="/css/main.min.css" />

	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs-okaidia-theme/prism-okaidia.min.css" />
	  <style>
	.post-title {
		font-size: 2em;
		color: #222;
		margin-bottom: 0.2em;
	}

	.post-content {
		color: #444;
		line-height: 1.8em;
	}

	.post-content a {
		color: #000036;
		text-decoration-line: underline;
		text-decoration-color: #ea215a;
		text-decoration-style: double;
		text-decoration-thickness: 0.125em;
		text-underline-offset: 1.5px;
		text-decoration-skip-ink: none;
		transition: 0.5s;
	}

	.post-content a:hover,
	.post-content a:focus,
	.post-content a:active {
		text-decoration: none;
		color: white;
		box-shadow: inset 0 -1.3em 0 0 #000;
		outline: thin dotted #ea215a;
	}
</style>


<style>
	.single-post :not(pre) code {
		background-color: #272822;
		color: #f8f8f2;
		border-radius: 0.3rem;
		padding: 4px 5px 5px;
	}
</style>
  
<style>
	@media screen and (min-width: 48em) and (max-width: 63.938em) {
		.post-title {
			font-size: 3em;
			margin-top: 0;
		}
	}

	@media (min-width: 64em) {
		.post-title {
			/* will affect single-post*/
			font-size: 4em;
			margin-top: 0;
		}
	}
</style>
    
<style>
	.post-meta {
		color: #16663d;
		font-size: 90%;
		margin: 0;
	}

	.posted-on {
		color: #ad1a36;
	}

	.post-tag {
		margin: 0 0.1em;
		padding: 0.2em 0.8em;
		background: #ad1a36;
		font-size: 80%;
	}

	.post-tag a {
		color: #fff;
	}
</style>
  

</head>


	<body>
		<div id="page" class="site grid">
			<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

			<style>
	.invisible {
		visibility: hidden;
	}

	.overlay {
		position: fixed;
		width: 0;
		height: 100%;
		top: 0;
		right: 0;
		background-color: rgba(0, 0, 0, 0.9);
		z-index: 2;
		letter-spacing: normal;
		overflow-x: hidden;
		transition: 0.5s;
	}

	.overlay-content {
		position: relative;
		top: 25%;
		width: 100%;
		text-align: center;
		margin-top: 30px;
	}

	.overlay li {
		list-style: none;
	}

	.overlay a {
		padding: 8px;
		text-decoration: none;
		font-size: 36px;
		color: #818181;
		display: block;
		transition: 0.3s;
	}

	.overlay a:hover,
	.overlay a:focus {
		color: #f1f1f1;
		background-color: #222;
		border: 1px solid red;
		border-style: dashed;
	}

	.overlay .close-button {
		position: absolute;
		top: 20px;
		right: 45px;
		font-size: 60px;
	}
</style>

<div id="main-nav" aria-label="Main navigation" class="overlay invisible" tabindex="-1">
	<a href="#" id="close-button" class="close-button" aria-label="Close menu" title="Close menu">
		&times;
	</a>
	
	<div class="overlay-content">
		<a href="/">Home</a>
		
		<li class="pure-menu-item">
			<a href="/posts">Archive</a>
		</li>
		
		<li class="pure-menu-item">
			<a href="/tags">Tags</a>
		</li>
		
		<li class="pure-menu-item">
			<a href="/search">Search</a>
		</li>
		
		<li class="pure-menu-item">
			<a href="/pages/about">About Me</a>
		</li>
		
		<li class="pure-menu-item">
			<a href="/rss.xml">RSS</a>
		</li>
		
	</div>
</div>
  <style>
	/* SITE HEADER */
	.site-header {
		background: rgb(61, 79, 93);
		color: #fff;
	}

	.sidebar {
		margin: 1em;
	}

	.site-title,
	.site-description {
		margin: 0;
		line-height: 1.2;
	}

	.site-title a {
		color: #fff;
		text-decoration: none;
	}

	.site-title a:hover,
	.site-title a:focus {
		text-decoration: underline;
	}

	.site-description {
		font-weight: 300;
		color: rgb(176, 202, 219);
		margin: 0.5em 0 2em 0;
	}

	/* MENU BUTTON */
	.nav-list {
		margin: 0;
		padding: 0;
		list-style: none;
	}

	.nav-item {
		display: inline-block;
	}

	.nav-item a {
		background: black;
		border: 2px solid rgb(176, 202, 219);
		border-radius: 2px;
		color: #fff;
		padding: 0.5em 1em;
		margin-top: 1em;
		letter-spacing: 0.05em;
		text-transform: uppercase;
		font-size: 85%;
	}

	.nav-item a:hover,
	.nav-item a:focus {
		border: 2px solid rgb(61, 146, 201);
		text-decoration: none;
	}

	.nav-item a svg {
		fill: aliceblue;
		vertical-align: bottom;
		padding: 4px 0 2px;
	}

	@media screen and (max-width: 35.5em) {
		.nav-item a svg {
			padding-top: 14px;
		}
	}

	@media screen and (min-width: 35.5em) and (max-width: 48em) {
		.nav-item a svg {
			padding-top: 12px;
		}
	}

	@media screen and (min-width: 48em) and (max-width: 63.938em) {
		.nav-item a svg {
			padding-top: 10px;
		}
	}

	/* more then 1023px an less then 1024px */
	@media (max-width: 63.969em) {
		.site-header.bio {
			background-image: none !important;
		}
		.nav {
			position: fixed;
			top: 15px;
			right: 10px;
			z-index: 1;
		}
	}

	@media (min-width: 64em) {
		.site-header {
			position: fixed;
			top: 0;
			bottom: 0;
			overflow-y: auto;
		}

		.site-header.bio {
			background-repeat: no-repeat;
			background-position: top;
			background-size: cover;
		}

		.site-header.bio .site-header-overlay {
			position: fixed;
			width: 100%;
			height: 100%;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(0, 0, 0, 0.6);
		}

		/* The emerging W3C standard
 that is currently Firefox-only */
		.site-header {
			scrollbar-width: thin;
		}

		/* Works on Chrome/Edge/Safari */
		.site-header::-webkit-scrollbar {
			width: 7px;
		}

		.site-header::-webkit-scrollbar-track {
			background: #313d48;
		}

		.site-header::-webkit-scrollbar-thumb {
			background-color: #81898f;
		}

		.sidebar {
			margin: 10% 2em;
			text-align: left;
		}

		.site-header.bio .sidebar {
			position: sticky;
		}
	}
</style>
<header id="masthead"  class="site-header unit-1 unit-lg-2-5 bio" style="background-image:
	url('/img/connected-gears-inside-pocket-watch.webp')"  >
	<div class="site-header-overlay"></div>
	
	<div class="sidebar">
		<div class="site-branding">
			<h1 class="site-title">
				<a href="/">{ LebCit }</a>
			</h1>
			<p class="site-description">Autodidactic Web Developer. Love to Read, Learn &amp; DIMySelf !</p>
		</div>

		
		<nav id="nav" class="nav" aria-label="MENU">
			<ul class="nav-list">
				<li class="nav-item">
					<a id="menu-button" aria-controls="main-nav" aria-haspopup="true" tabindex="0" role="button">
						<span>MENU</span>
						<span class="menu-icon" aria-hidden="true">
							<svg
								version="1.1"
								x="0px"
								y="0px"
								width="30px"
								height="30px"
								viewbox="0 0 30 30"
								enable-background="new 0 0 30 30"
							>
								<rect width="30" height="5" />
								<rect y="24" width="30" height="5" />
								<rect y="12" width="30" height="5" />
							</svg>
						</span>
					</a>
				</li>
			</ul>
		</nav>
		
	</div>
	
</header>


			<div id="content" class="site-content unit-1 unit-lg-3-5">
				  
				<main class="single-post"><style>
	.author-greetings {
		color: #000;
		line-height: normal;
	}
</style>

<header class="post-header">
	<h1 class="post-title">Turn a Markdown blog to a simple SSG</h1>
	
	<p class="post-meta">
		<span>Posted on</span>
		<span class="posted-on">
			<time class="postList-date" datetime='2022-07/31'>
				Sun Jul 31 2022
			</time>
		</span>

		<br />
		Tagged  
		<span class="post-tag">
			<a href="/tags/Development">Development</a>
		</span>
		
		<span class="post-tag">
			<a href="/tags/Node.js">Node.js</a>
		</span>
		
		<span class="post-tag">
			<a href="/tags/Express">Express</a>
		</span>
		
		<span class="post-tag">
			<a href="/tags/EJS">EJS</a>
		</span>
		  
	</p>
	  
</header>

<div class="post-content">
	
	<p>
		<em>This post is about improving a Markdown blog and turn it into a simple SSG</em>
		.
	</p>
	  <h2>Intro</h2>
<p>Over the past few weeks, I mostly wrote on how to template a Node.js application with <a href="https://ejs.co/">EJS</a> using <a href="https://expressjs.com/">Express</a>.<br>
Then, I wrote an article showing how to create a Markdown blog in Node.js using EJS, Express, <a href="https://www.npmjs.com/package/gray-matter">gray-matter</a> and <a href="https://www.npmjs.com/package/markdown-it">markdown-it</a>.<br>
Today, I'll combine those tutorials to turn the Markdown blog, from <a href="/posts/markdown-blog-with-ejs/">the last tutorial</a>, into a simple SSG.</p>
<h2>Jamstack &amp; SSG</h2>
<p>Wherever you head on the web, the content you'll get as a client is made of HTML, CSS and some JavaScript.<br>
Think of HTML as a skeleton, CSS as it's external shapes and colors, and JavaScript as it's internal functionalities.<br>
With this in mind, you can ask yourself about the need of server side rendering...<br>
Static sites are way performant and secure than dynamic ones.<br>
But what about the need of interacting with a database or sending data on a particular page... ?<br>
This is where the JAMstack (JavaScript, APIs, and Markup) steps in to leverage the static notion from &quot;fixed&quot; to &quot;on demand dynamic functionalities&quot; like submitting forms, posting comments, making payments, searching content, authentication, and so on...<br>
Today <a href="https://jamstack.org/">Jamstack</a> is a continuous evolving ecosystem allowing developers to build better, faster and more secure applications, without losing the advantage of using dynamic features.</p>
<p>All of this is great but <em>easier said than done</em>.<br>
I took the time, excitement, ambition and hard work of great developers to bring this concept to life.<br>
Today, you can head over the <a href="https://jamstack.org/generators/">list of Static Site Generators for Jamstack sites</a>, choose what suits your needs, read the documentation, and build your project effortlessly in no time.<br>
A simple explanation of a SSG is that it takes data passed to templates and generates HTML pages, just like a blender that gives you a ready-to-drink cocktail.<br>
At the date of writing this article, the Jamstack site lists more than 300 SSGs used to pre-built ready to serve HTML pages.<br>
But if you want to have your own dead simple SSG, that's also possible !</p>
<h2>Improving our Markdown blog</h2>
<p>The Markdown blog from the last tutorial was already a simple SSG, since it was taking data passed to templates and generating HTML pages out of them !<br>
But everything was inside the main server file and if we wanted to add more functionalities, the file would become crowded and unmaintainable.<br>
This is why, I'll show you how to improve this backend and make it ready to adopt more features.</p>
<h3>LiveReload</h3>
<hr>
<p>It would be a waist of time if we had to reload the server and refresh the browser to see our changes each time we make some of them.<br>
In <a href="/posts/templating-a-nodejs-app-with-ejs/">Templating a Node.js app with EJS</a>, we've learned how to implement a live reload from the main server file.<br>
This time, we'll put this feature as a separate file.<br>
Let's bring in three development dependencies :</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">-D</span> nodemon livereload connect-livereload
</code></pre>
<p>In the main server file, <code>index.js</code>, add a line to export <code>app</code> :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// /index.js</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span>app <span class="token operator">=</span> app üëà
<span class="token operator">...</span>
</code></pre>
<p>Now we can call <code>app</code> in other files üòâ<br>
At the root of the application, create a file called <code>liveReload.js</code> with the following content :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// /liveReload.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	<span class="token comment">/** Start LiveReload implementation  */</span>
	<span class="token keyword">const</span> livereload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"livereload"</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> connectLiveReload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"connect-livereload"</span><span class="token punctuation">)</span>
	<span class="token keyword">const</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./index"</span><span class="token punctuation">)</span> üëà

	<span class="token comment">// Create a server with livereload and fire it up</span>
	<span class="token keyword">const</span> liveReloadServer <span class="token operator">=</span> livereload<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// Refresh the browser after each saved change on the server with a delay of 100 ms</span>
	liveReloadServer<span class="token punctuation">.</span>server<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
		<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
			liveReloadServer<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// Add livereload script to the response</span>
	app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">connectLiveReload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">/** End LiveReload implementation  */</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now, back to <code>index.js</code>, let's <code>require</code> this function :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// /index.js</span>
<span class="token operator">...</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"view engine"</span><span class="token punctuation">,</span> <span class="token string">"ejs"</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// LiveReload</span>
<span class="token keyword">const</span> liveReload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./liveReload"</span><span class="token punctuation">)</span>
<span class="token function">liveReload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre>
<p>Finally, let's add a script to <code>package.json</code> :</p>
<pre class="language-json"><code class="language-json"><span class="token comment">// /package.json</span>
...
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"watch"</span><span class="token operator">:</span> <span class="token string">"nodemon -e js,ejs,css,md"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre>
<p>Now, the following command <code>npm run watch</code> will tell Nodemon to watch for any changes in <code>.js</code>, <code>.ejs</code>, <code>.css</code> and <code>.md</code> files, and restart the server while <code>liveReload()</code> will reload the browser.</p>
<h3>Routing</h3>
<hr>
<p>The routes where defined in <code>index.js</code>, let's also put them in their own directory.<br>
At the root of the application, create a folder called <code>routes</code>.<br>
Inside this folder, create 2 files :</p>
<ol>
<li><code>mainRoute.js</code></li>
<li><code>postsRoute.js</code></li>
</ol>
<p>The first one is obviously for the homepage, and the second one is for each individual post.</p>
<p>Since we have multiple routes and each one will be in it's own file, let's use a <a href="/posts/express-global-router-for-a-dry-code/">global router in Express for a DRY code</a>.<br>
In <code>index.js</code>, parse an <code>express.Router()</code> to a <code>global.router</code> assigned to a <code>router</code> variable, then use it in the app :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// /index.js</span>
<span class="token operator">...</span>
<span class="token comment">// LiveReload</span>
<span class="token keyword">const</span> liveReload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./liveReload"</span><span class="token punctuation">)</span>
<span class="token function">liveReload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Express global router</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token punctuation">(</span>global<span class="token punctuation">.</span>router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre>
<p>Now, let's move the logic of each route in it's own file :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// /routes/mainRoute.js</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> global<span class="token punctuation">.</span>router

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> matter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"gray-matter"</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">getPosts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	<span class="token comment">// Get the posts from their directory</span>
	<span class="token keyword">const</span> posts <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../views/posts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token operator">=></span> post<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">".md"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// Set the post content as an empty array</span>
	<span class="token keyword">const</span> postContent <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token comment">// Inject into the post content array the front matter</span>
	posts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
		postContent<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>matter<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../views/posts/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">/**
	 * 1- Return a list of posts as a two dimensional array containing for each one :
	 * . the post filename with it's extension (e.g : postFilename.md)
	 * . the post content as an object {content:"Markdown content as a string", data:{front matter}, excerpt:""}
	 * 2- Return each array as an object and create a Date instance from it's date front matter
	 * 3- Sort posts by publication's date in descending order (newest to oldest)
	 */</span>
	<span class="token keyword">const</span> postsList <span class="token operator">=</span> posts
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">post<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">[</span>post<span class="token punctuation">,</span> postContent<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj<span class="token punctuation">,</span> <span class="token literal-property property">date</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">objA<span class="token punctuation">,</span> objB</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Number</span><span class="token punctuation">(</span>objB<span class="token punctuation">.</span>date<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">Number</span><span class="token punctuation">(</span>objA<span class="token punctuation">.</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> postsList
<span class="token punctuation">}</span>

<span class="token comment">// Render the list of posts on the main route</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"postsList"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token function">getPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre>
<pre class="language-js"><code class="language-js"><span class="token comment">// /routes/postsRoute.js</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> global<span class="token punctuation">.</span>router

<span class="token keyword">const</span> matter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"gray-matter"</span><span class="token punctuation">)</span>

<span class="token comment">// Using a route parameter to render each post on a route matching it's filename</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/posts/:post"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> postTitle <span class="token operator">=</span> req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>post <span class="token comment">// Get the Markdown filename</span>

	<span class="token comment">// Read the Markdown file and parse it's front matter</span>
	<span class="token keyword">const</span> post <span class="token operator">=</span> matter<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/../views/posts/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>postTitle<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.md</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

	<span class="token comment">// Convert the Markdown file content to HTML with markdown-it</span>
	<span class="token keyword">const</span> md <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"markdown-it"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Allows HTML tags inside the Markdown file</span>
	<span class="token keyword">const</span> content <span class="token operator">=</span> post<span class="token punctuation">.</span>content <span class="token comment">// Read the Markdown file content</span>
	<span class="token keyword">const</span> html <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token comment">// Convert the Markdown file content to HTML</span>

	<span class="token comment">// Render the postsTemplate for each post and pass it's front matter as a data object into postsTemplate</span>
	res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"postsTemplate"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">title</span><span class="token operator">:</span> post<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
		<span class="token literal-property property">date</span><span class="token operator">:</span> post<span class="token punctuation">.</span>data<span class="token punctuation">.</span>date<span class="token punctuation">,</span>
		<span class="token literal-property property">postContent</span><span class="token operator">:</span> html<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre>
<p><em>Nota bene: in both files, I've replaced concatenation with template strings for paths</em>.</p>
<p>Update <code>index.js</code> to <code>require</code> those routes :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">// /index.js - COMPLETE FILE</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
exports<span class="token punctuation">.</span>app <span class="token operator">=</span> app

app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"view engine"</span><span class="token punctuation">,</span> <span class="token string">"ejs"</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// LiveReload</span>
<span class="token keyword">const</span> liveReload <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./liveReload"</span><span class="token punctuation">)</span>
<span class="token function">liveReload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Express global router</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token punctuation">(</span>global<span class="token punctuation">.</span>router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>

<span class="token comment">// Routes</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./routes/mainRoute"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./routes/postsRoute"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Launching the application on port 3000</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">App üöÄ @ http://localhost:3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Now that's a clean server file üëç</p>
<h3>Styles and Scripts</h3>
<hr>
<p><strong>Important subsection ahead !</strong></p>
<p>In a common webapp, we would have a main stylesheet as well as a main scripts file.<br>
Both files would be rendered on each and every page of the application, but we all know that we do not need all the styles nor all the scripts on every page !<br>
If you look closer to <code>postsRoute.js</code>, even in <code>index.js</code> from the last tutorial, we passed an option along with <code>markdown-it</code> to allow HTML tags inside the Markdown files :</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> md <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"markdown-it"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>So we can use <code>&lt;style&gt;</code> and <code>&lt;script&gt;</code> tags inside our Markdown files üòâ<br>
Let's try to change the color of the title in <code>my-first-article.md</code> :</p>
<pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span>
<span class="token front-matter yaml language-yaml">title: My first article
date: 2022/07/25</span>
<span class="token punctuation">---</span></span>

This is the content of my first article

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">h1</span><span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span>red<span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- /views/posts/my-first-article.md --></span>
</code></pre>
<p>Take a look at this post, the title is now red !<br>
But if you look at <code>a-second-post.md</code>, the title is still black !<br>
This is awesome, we can load individual styles for each and every post ü•≥</p>
<p>The same logic is applicable for scripts :</p>
<pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span>
<span class="token front-matter yaml language-yaml">title: My first article
date: 2022/07/25</span>
<span class="token punctuation">---</span></span>

This is the content of my first article

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">h1</span><span class="token punctuation">{</span><span class="token property">color</span><span class="token punctuation">:</span>red<span class="token punctuation">}</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello from my-first-article.md"</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!-- /views/posts/my-first-article.md --></span>
</code></pre>
<p>Okay, but what if a page has a decent amount of individual styles or scripts and we don't want to put the whole block inside the Markdown file ?<br>
Good question ! Easy-peasy, just load it as you would normally do it.<br>
Let's say that I have some particular styles and scripts for <code>a-second-post.md</code>.<br>
Create a folder at the root of the application called <code>public</code> and under it create two folders called <code>css</code> and <code>scripts</code>.<br>
In <code>css</code>, create a file called <code>second-post-styles.css</code> with the following content :</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* /public/css/second-post-styles.css */</span>
<span class="token selector">h1</span> <span class="token punctuation">{</span>
	<span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>In <code>scripts</code>, create a file called <code>second-post-scripts.js</code> with the following content :</p>
<pre class="language-js"><code class="language-js"><span class="token comment">/* /public/scripts/second-post-scripts.js */</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello from second-post-scripts.js"</span><span class="token punctuation">)</span>
</code></pre>
<p>Now, update <code>a-second-post.md</code> to look like this :</p>
<pre class="language-md"><code class="language-md"><span class="token front-matter-block"><span class="token punctuation">---</span>
<span class="token front-matter yaml language-yaml">title: A second post
date: 2022/07/28</span>
<span class="token punctuation">---</span></span>

Here goes the content of my second post

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/css/second-post-styles.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/scripts/second-post-scripts.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!--- /views/posts/a-second-post.md --></span>
</code></pre>
<p>Take a look at this post, the title is now blue and if you open the browser's console <code>F12</code>, you'll see the message ü•≥</p>
<p>‚ö†Ô∏è The first slash <code>/</code> in the paths <code>href</code> and <code>src</code> is mandatory, if you omit it you'll get an error in the console.<br>
The reason is because the <code>link</code> and <code>script</code> tags are treated as a Markdown content, converted to HTML, injected in EJS template, rendered on the frontend.<br>
If we omit the first slash, the Markdown parser will think that those folder are in the same folder as the post, the <code>posts</code> folder, then those incorrect paths will be converted to HTML and injected into the EJS template that will render the post on the frontend where the browser will respond with a <code>404 Not Found</code>.<br>
By putting a slash <code>/</code> at the beginning of the path, Express will understand that we are asking for folders and files living under the the root directory from which to serve static assets, the <code>public</code> folder :</p>
<pre class="language-js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p><em>Nota bene : the first slash <code>/</code> is not mandatory for a path directly defined in a template, an <code>.ejs</code> file</em>.<br>
In our case, <code>postsTemplate.ejs</code> is an exception because it's rendered on a dynamic route where the content comes from a parsed Markdown file, so in this file and every similar file, if we want to use the <code>public</code> folder, all our paths must begin with a slash <code>/</code>.</p>
<h2>Conclusion</h2>
<p>From here, you can take control over this simple SSG and maybe add a <code>pagesTemplate.ejs</code>, a pagination, a contact form, a searchbox...</p>
<p>I hope that this was helpful.
Thanks for reading so far.</p>

	<p class="author-greetings">
		SYA,
		<br />
		LebCit.
	</p>
</div>

  <style>
	.post-navigation {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		grid-template-rows: 1fr;
		grid-column-gap: 16px;
	}

	.post-navigation a {
		margin: 1.5em 0;
		border: 2px solid #000;
		background: #000;
		display: inline-block;
		padding: 0.7rem 0.9rem;
		font-size: 1rem;
		line-height: 1;
		border-radius: 3px;
		color: #fff;
		font-weight: 600;
		cursor: pointer;
	}

	.post-navigation .next-post {
		grid-column-end: -1;
	}

	.post-navigation a:hover {
		color: #fff;
		box-shadow: 0 0.25em #000;
	}

	.post-navigation a:active,
	.post-navigation a:focus {
		color: #fff;
		box-shadow: 0.25em 0.25em #000;
		outline: 0.1em solid;
	}

	@media screen and (max-width: 48em) {
		.post-navigation {
			display: grid;
			grid-template-columns: 1fr;
			grid-template-rows: repeat(2, 1fr);
			grid-row-gap: 16px;
		}

		.post-navigation a {
			margin: 0;
		}
	}
</style>

<nav class="post-navigation" aria-label="Post navigation">
	
	<a href="/posts/markdown-blog-with-ejs" class="prev-post" rel="prev" aria-label="Go to the previous post">
		Previous: Markdown blog with EJS
	</a>
	  
	<a href="/posts/click-without-javascript" class="next-post" rel="next" aria-label="Go to the next post">Next: Click without JavaScript !</a>
	
</nav>
   <style>
	.related-posts div {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		grid-template-rows: 1fr;
		grid-column-gap: 16px;
	}
</style>

<div class="related-posts">
	<h3>SOME RELATED POSTS</h3>
	<div>
		      
		<section>
			<a href="/posts/markdown-blog-with-ejs">
				    
				<img
					class="img-responsive"
					src="/img/markdown-logo-with-white-background.webp"
					alt="Markdown logo with white background"
				/>
				
			</a>
			<h4>
				<a href="/posts/markdown-blog-with-ejs">Markdown blog with EJS</a>
			</h4>
		</section>
		      
		<section>
			<a href="/posts/templating-a-nodejs-app-with-ejs">
				    
				<img
					class="img-responsive"
					src="/img/block-of-red-orange-yellow-and-green-lego.webp"
					alt="Block of red orange yellow and green lego"
				/>
				
			</a>
			<h4>
				<a href="/posts/templating-a-nodejs-app-with-ejs">Templating a Node.js app with EJS</a>
			</h4>
		</section>
		
	</div>
</div>
  
</main>
				       
			</div>
			 <style>
	.site-footer {
		text-align: center;
		padding-top: 2em;
	}
	@media (min-width: 64em) {
		.site-footer {
			padding: 2em 3em;
			margin-left: 40%;
		}
	}
</style>

<footer id="colophon" class="site-footer unit-1">
	        

	<div id="site-info" class="site-info">
		<p>
			<strong>2016 - 2023 | { LebCit }</strong>
			<br />
			<span>Proudly created with </span><a href='https://github.com/LebCit/blog-doc-space'>Blog-Doc</a>
		</p>
	</div>
</footer>

		</div>
		   
		<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
		

		<script src="/js/main.js"></script>
	</body>
</html>
